language: php

sudo: false

cache:
    directories:
        - $HOME/.composer/cache

matrix:
    fast_finish: true
    include:
        - php: 5.5
        - php: 5.5
          env: DEPENDENCIES='low' LINT=1
        - php: 5.5
          env: DEPENDENCIES='beta'
        - php: 5.6
        - php: 5.6
          env: DEPENDENCIES='low'
        - php: 5.6
          env: DEPENDENCIES='beta'
        - php: 7.0
        - php: 7.0
          env: DEPENDENCIES='low'
        - php: 7.0
          env: DEPENDENCIES='beta'
        - php: 7.1
        - php: 7.1
          env: DEPENDENCIES='low'
        - php: 7.1
          env: DEPENDENCIES='beta'

before_install:
    - if [[ $LINT = 1 ]]; then wget https://github.com/FriendsOfPHP/PHP-CS-Fixer/releases/download/v2.1.1/php-cs-fixer.phar; fi

install:
    - if [[ $DEPENDENCIES = 'beta' ]]; then composer config minimum-stability beta; fi
    - if [[ ! $DEPENDENCIES || $DEPENDENCIES = 'beta' ]]; then composer update --prefer-dist --no-progress --no-suggest --ansi; fi
    - if [[ $DEPENDENCIES = 'low' ]]; then composer update --prefer-dist --no-progress --no-suggest --prefer-stable --prefer-lowest --ansi; fi

script:
    - if [[ $LINT = 1 ]]; then php php-cs-fixer.phar fix --dry-run --diff; fi
    - vendor/bin/phpunit
    - vendor/bin/behat
    - vendor/bin/behat -p jmsserializer
